{% extends "core/faculty/sidebar.html" %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

{% block body %}

<h1 class="h3 mb-4"><strong>Class List</strong></h1>

<div class="row">
    <div class="col-auto">
        <!-- File upload section -->
        <input type="file" id="classListFile" accept=".csv, .xlsx" style="display: none;" multiple>
        <button class="btn btn btn-sm" onclick="uploadClassList()" style="background-color:#800000; color: white;">Upload Class List</button>
        <div id="uploadedFilesList" style="margin-top: 20px;">
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-auto">
        <!-- Display saved classlists -->
        {% for item in classlist_with_users %}
            {% if item.creator_id == current_user.id %} {# Assuming the creator_id is stored in your ClassList model #}
                <div class="row">
                    <div class="col-auto">
                        <h4>{{ item.classlist_entry.subject_name }} - {{ item.classlist_entry.section_name }}</h4>
                        <ul>
                            {% for user in item.users %}
                                <li>{{ user.first_name }} {{ user.last_name }} - {{ user.email }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>

<script>
    // Existing JavaScript code...

    function uploadClassList() {
        // Trigger the click event on the hidden file input
        document.getElementById('classListFile').click();
    }

    // Update this function to handle the file upload and trigger the Flask route
    function handleFileUpload() {
        var fileInput = document.getElementById('classListFile');
        var formData = new FormData();

        // Add the selected files to the FormData object
        for (var i = 0; i < fileInput.files.length; i++) {
            formData.append('files[]', fileInput.files[i]);
        }

        // Add school_year and semester to the FormData object
        formData.append('school_year', document.getElementById('school_year').value);
        formData.append('semester', document.getElementById('semester').value);

        // Use fetch to send a POST request to the Flask route
        fetch('/upload_classlist', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // Handle the response if needed
            console.log(data);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

</script>

{% endblock %}
